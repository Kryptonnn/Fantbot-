import random
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes, MessageHandler, filters

BOT_TOKEN = "8115312798:AAFEBMl7KrxmAynmT9A1LqNcS17Ns6pa7P4"

levels = {
    "–õ–∞–π—Ç": [
        "–°–Ω–∏–º–∏ –æ–¥–Ω—É –≤–µ—â—å –æ–¥–µ–∂–¥—ã.",
        "–ù–µ–∂–Ω–æ –ø–æ—Ü–µ–ª—É–π –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ —à–µ—é.",
        "–°–¥–µ–ª–∞–π –ø–∞—Ä—Ç–Ω—ë—Ä—É –º–∞—Å—Å–∞–∂ —Å–ø–∏–Ω—ã 2 –º–∏–Ω—É—Ç—ã.",
        "–ü—Ä–æ—à–µ–ø—á–∏ –ø–∞—Ä—Ç–Ω—ë—Ä—É –Ω–∞ —É—Ö–æ, —á—Ç–æ —Ç—ã —Å –Ω–∏–º —Å–¥–µ–ª–∞–µ—à—å –ø–æ–∑–∂–µ.",
        "–û–±–ª–∏–∂–∏ –ø–∞—Ä—Ç–Ω—ë—Ä—É –ø–∞–ª–µ—Ü, –∫–∞–∫ –±—É–¥—Ç–æ —ç—Ç–æ —á—Ç–æ-—Ç–æ –Ω–µ–ø—Ä–∏–ª–∏—á–Ω–æ–µ.",
        "–°–¥–µ–ª–∞–π 3 –ø–æ—â—ë—á–∏–Ω—ã –ø–æ –ø–æ–ø–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞.",
        "–û–ø–∏—à–∏ —ç—Ä–æ—Ç–∏—á–µ—Å–∫—É—é —Ñ–∞–Ω—Ç–∞–∑–∏—é —Å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º.",
        "–ü—É—Å—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä —Ç–µ–±—è –Ω—é—Ö–∞–µ—Ç —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏ –∏ —É–≥–∞–¥—ã–≤–∞–µ—Ç, –≥–¥–µ.",
        "–ü–æ–º–µ–Ω—è–π—Ç–µ—Å—å –Ω–∏–∂–Ω–∏–º –±–µ–ª—å—ë–º –Ω–∞ 5 –º–∏–Ω—É—Ç.",
        "–°–¥–µ–ª–∞–π –ø–∞—Ä—Ç–Ω—ë—Ä—É 5 –ø–æ—Ü–µ–ª—É–µ–≤, –Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –≤ –≥—É–±—ã."
    ],
    "–°—Ä–µ–¥–Ω–∏–π": [
        "–í—Å—Ç–∞–≤—å –∞–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–±–∫—É –∏ –æ—Å—Ç–∞–Ω—å—Å—è —Å –Ω–µ–π –Ω–∞ 10 –º–∏–Ω—É—Ç.",
        "–ü–æ–∏–≥—Ä–∞–π —Å EXTREME MAGIC WAND –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ 2 –º–∏–Ω—É—Ç—ã.",
        "–ü–∞—Ä—Ç–Ω—ë—Ä –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∏–±—Ä–æ—è–π—Ü–æ ‚Äî –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏–º 3 –º–∏–Ω—É—Ç—ã.",
        "–ü–æ—Å—Ç–∞–≤—å Orca –Ω–∞ –∫–ª–∏—Ç–æ—Ä –∏ –ø—Ä–æ–¥–µ—Ä–∂–∏ 60 —Å–µ–∫—É–Ω–¥.",
        "–ü—É—Å—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä –ª–∏–∂–µ—Ç —Å–æ—Å–∫–∏ 1 –º–∏–Ω—É—Ç—É, –ø–æ–∫–∞ —Ç—ã –ª–µ–∂–∏—à—å —Å–≤—è–∑–∞–Ω–Ω—ã–π(–∞—è).",
        "–í—ã–±–µ—Ä–∏ –ø–æ–∑—É –∏ –∑–∞–º—Ä–∏ –≤ –Ω–µ–π, –ø–æ–∫–∞ –ø–∞—Ä—Ç–Ω—ë—Ä —Ç–µ–±—è –¥—Ä–∞–∑–Ω–∏—Ç.",
        "–û–±–ª–∏–∂–∏ –ø–∞—Ä—Ç–Ω—ë—Ä—É –∂–∏–≤–æ—Ç –∏ –Ω–∏–∂–µ‚Ä¶ –Ω–æ –Ω–µ —Ç—Ä–æ–≥–∞–π –∏–Ω—Ç–∏–º–Ω–æ–µ.",
        "–°–Ω–∏–º–∏ –≤—Å—ë –∏ —Å—è–¥—å –Ω–∞ –∫–æ–ª–µ–Ω–∏ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º, —Å–º–æ—Ç—Ä–∏ –≤ –≥–ª–∞–∑–∞ 30 —Å–µ–∫.",
        "–î–∞–π –ø–∞—Ä—Ç–Ω—ë—Ä—É –º–∏–æ—Å—Ç–∏–º—É–ª—è—Ü–∏—é –Ω–∞ –º–∞–ª–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ 2 –º–∏–Ω—É—Ç—ã.",
        "–ü–∞—Ä—Ç–Ω—ë—Ä –≥–ª–∞–¥–∏—Ç —Ç–≤–æ—ë —Ç–µ–ª–æ –∏–≥—Ä—É—à–∫–æ–π, –ø–æ–∫–∞ —Ç—ã —Å –∑–∞–≤—è–∑–∞–Ω–Ω—ã–º–∏ –≥–ª–∞–∑–∞–º–∏."
    ],
    "–ñ—ë—Å—Ç–∫–∏–π": [
        "–ü—É—Å—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä –≤—Å—Ç–∞–≤–∏—Ç –¥–∏–ª–¥–æ –Ω–∞ –ø—Ä–∏—Å–æ—Å–∫–µ –≤ —Ç–µ–±—è ‚Äî —Å–∞–º/—Å–∞–º–∞ –∫—Ä—É—Ç–∏ —Ç–∞–∑–æ–º.",
        "–°—Ç–∏–º—É–ª—è—Ü–∏—è EXTREME MAGIC WAND –Ω–∞ –º–∞–∫—Å–∏–º—É–º 2 –º–∏–Ω—É—Ç—ã ‚Äî –±–µ–∑ –æ—Ä–≥–∞–∑–º–∞.",
        "–ú–∞—Å—Ç—É—Ä–±–∏—Ä—É–π —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º –º–∞—Å—Ç—É—Ä–±–∞—Ç–æ—Ä–æ–º 1 –º–∏–Ω—É—Ç—É –ø–µ—Ä–µ–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º.",
        "–ó–∞—Å—É–Ω—å –∞–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–±–∫—É –∏ –≤—ã–ø–æ–ª–Ω–∏ 10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π.",
        "–ú–∏–æ—Å—Ç–∏–º—É–ª—è—Ü–∏—è —Ç–æ–∫–æ–º –Ω–∞ –º–∞–∫—Å–∏–º—É–º–µ 1 –º–∏–Ω—É—Ç—É.",
        "–°–∏–¥–∏ –≥–æ–ª—ã–º(–æ–π), –ø–æ–∫–∞ –ø–∞—Ä—Ç–Ω—ë—Ä —Ç–µ–±–µ —à–µ–ø—á–µ—Ç –Ω–µ–ø—Ä–∏–ª–∏—á–Ω—ã–µ –ø—Ä–∏–∫–∞–∑—ã.",
        "–î—Ä–æ—á–∏ –ø–∞—Ä—Ç–Ω—ë—Ä—É, –ø–æ–∫–∞ –æ–Ω/–æ–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç —Ç–µ–±–µ –≥–∞–¥–æ—Å—Ç–∏.",
        "–û—Ä–∞–ª—å–Ω–æ–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ ‚Äî 2 –º–∏–Ω—É—Ç—ã, –ø–æ —Ç–∞–π–º–µ—Ä—É, –ø–æ—Ç–æ–º –æ—Å—Ç–∞–Ω–æ–≤–∫–∞.",
        "–ü–æ–ø—Ä–æ–±—É–π –¥–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ: –≤–∏–±—Ä–æ-—è–π—Ü–æ + Orca.",
        "–ù–∞–¥–µ–Ω—å –ø–æ–≤—è–∑–∫—É –∏ –ø—Ä–∏–≤—è–∂–∏ –µ—ë –∫ –∫—Ä–æ–≤–∞—Ç–∏, –ø–æ–∫–∞ —Ç–µ–±–µ –±—É–¥—É—Ç —á–∏—Ç–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–Ω—Ç."
    ]
}

current_level = "–õ–∞–π—Ç"

def get_keyboard():
    return ReplyKeyboardMarkup(
        [
            ["/next", "/setlevel –õ–∞–π—Ç"],
            ["/setlevel –°—Ä–µ–¥–Ω–∏–π", "/setlevel –ñ—ë—Å—Ç–∫–∏–π"],
            ["‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"]
        ],
        resize_keyboard=True
    )

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        f"–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —Å —Ñ–∞–Ω—Ç–∞–º–∏ –¥–ª—è –ø–æ—Å—Ç–µ–ª—å–Ω—ã—Ö –∏–≥—Ä.\n–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: {current_level}\n"
        "–ù–∞–ø–∏—à–∏ /next ‚Äî –∏ —è –ø—Ä–∏—à–ª—é —Ç–µ–±–µ —Ñ–∞–Ω—Ç!",
        reply_markup=get_keyboard()
    )

async def next_fant(update: Update, context: ContextTypes.DEFAULT_TYPE):
    fan_list = levels.get(current_level, [])
    if not fan_list:
        await update.message.reply_text("–§–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.")
        return
    fan = random.choice(fan_list)
    await update.message.reply_text(fan)

async def set_level(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global current_level
    if not context.args:
        await update.message.reply_text("–£–∫–∞–∂–∏ —É—Ä–æ–≤–µ–Ω—å –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã. –ù–∞–ø—Ä–∏–º–µ—Ä: /setlevel –°—Ä–µ–¥–Ω–∏–π")
        return
    level = " ".join(context.args)
    if level not in levels:
        await update.message.reply_text(f"–ù–µ–≤–µ—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {', '.join(levels.keys())}")
        return
    current_level = level
    await update.message.reply_text(f"–£—Ä–æ–≤–µ–Ω—å —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {current_level}")

async def add_fant(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not context.args:
        await update.message.reply_text("–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç —Ñ–∞–Ω—Ç—ã –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã. –ü—Ä–∏–º–µ—Ä: /addfant –ü–æ—Ü–µ–ª—É–π –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ —à–µ—é")
        return
    new_fant = " ".join(context.args)
    levels[current_level].append(new_fant)
    await update.message.reply_text(f"–§–∞–Ω—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —É—Ä–æ–≤–µ–Ω—å {current_level}.")

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_text = (
        "üìú –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:\n"
        "/start ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é\n"
        "/next ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–Ω—Ç –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è\n"
        "/setlevel <—É—Ä–æ–≤–µ–Ω—å> ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å (–õ–∞–π—Ç, –°—Ä–µ–¥–Ω–∏–π, –ñ—ë—Å—Ç–∫–∏–π)\n"
        "/addfant <—Ç–µ–∫—Å—Ç —Ñ–∞–Ω—Ç—ã> ‚Äî –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —Ñ–∞–Ω—Ç—É –≤ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å\n"
        "‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ"
    )
    await update.message.reply_text(help_text)

async def instruction_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if update.message.text == "‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è":
        await help_command(update, context)

def main():
    app = ApplicationBuilder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("next", next_fant))
    app.add_handler(CommandHandler("setlevel", set_level))
    app.add_handler(CommandHandler("addfant", add_fant))
    app.add_handler(CommandHandler("help", help_command))

    app.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), instruction_handler))

    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω")
    app.run_polling()

if __name__ == "__main__":
    main()
